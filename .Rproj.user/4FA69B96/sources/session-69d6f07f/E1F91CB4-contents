---
title: "Examen_II_G1_C4H522"
format:
  html:
    embed-resources: true   
    code-fold: false        
execute:
  echo: true                
  warning: false            
  message: false 
---

Link al repositorio: <https://github.com/eetefy2311/Examen_II_G1_C4H522>

## 1. Cargar la data
```{r, warning=FALSE, message=FALSE}
library(here)
library(dplyr)

data.original<- read.table(
  here("data", "moras.txt"),
  header = TRUE,
  sep = ","
)

moras <- read.table(
  here("data", "moras.txt"),
  header = TRUE,
  sep = ","
)

View(moras)
```

## 2. Resumen de 5 números
Para encontrar la moda, se usó la librería *modeest*, la cual se implementó de acuerdo a lo establecido con la fuente <https://rpubs.com/Daniel21040506/834940>. 

Además, de esto, a la hora de subir la data se cambió la coma a un punto, ya que estaba representando problemas con algunos cálculos. 

De esta manera, lo que se presenta a continuación es equivalente a lo trabajado en el archivo excel.
```{r, warning=FALSE, message=FALSE}

#install.packages("modeest")
library(modeest)
library(stringr)

moras <- moras %>% 
  mutate(
    SALARIO = SALARIO %>% 
      str_replace(",", ".") %>% 
      as.numeric()
  )

resumen <- moras %>% 
  summarise(
    moda.salario = mfv(SALARIO, na.rm = TRUE),
    prom.salario = mean(SALARIO, na.rm = TRUE),
    mediana.salario = median(SALARIO, na.rm = TRUE),
    desv.salario = sd(SALARIO, na.rm = TRUE),
    min.salario = min(SALARIO, na.rm = TRUE),
    max.salario = max(SALARIO, na.rm = TRUE),
    moda.edad = mfv(EDAD, na.rm = TRUE),
    prom.edad = mean(EDAD, na.rm = TRUE),
    mediana.edad = median(EDAD, na.rm = TRUE),
    desv.edad = sd(EDAD, na.rm = TRUE),
    min.edad = min(EDAD, na.rm = TRUE),
    max.edad = max(EDAD, na.rm = TRUE)
  )

resumen

#str(moras)
```
## 3. Valores atípicos

Para esta sección, se crearon las nuevas columnas en el dataFrame moras, y para mostar el resultado se muestran únicamente las columnas nuevas.

Al final se muestran los primeros 15 datos.

```{r, warning=FALSE, message=FALSE}
prom.salario <- mean(moras$SALARIO, na.rm = TRUE)
desv.salario <- sd(moras$SALARIO, na.rm = TRUE)

prom.edad <- mean(moras$EDAD, na.rm = TRUE)
desv.edad <- sd(moras$EDAD, na.rm = TRUE)

moras <- moras %>% 
  mutate(
    Z.Score.Salario = (SALARIO-prom.salario)/desv.salario,
    Atípico.salario = ifelse(Z.Score.Salario > 1.96, "Atípico", "No atípico"),
    Z.Score.Edad = (EDAD-prom.edad)/desv.edad,
    Atípico.edad = ifelse(Z.Score.Edad > 1.96, "Atípico", "No atípico")
  )

moras %>% 
  select(Z.Score.Salario, Atípico.salario, Z.Score.Edad, Atípico.edad) %>% 
  head(15)
```

## 4. Porcentaje de valores faltantes

Para esta sección, aplicamos el proceso para todas las columnas del dataFrame, para observar cuales tienen valores faltantes. 

```{r, warning=FALSE, message=FALSE}
porc.na <- data.original %>% 
  summarise(across(everything(), ~ mean(is.na(.))*100))

porc.na
```

## 5. Imputar valores faltantes

Para imputar los datos, en caso de que se tratara de una variable categórica (Tipo de aseguramiento) se utilizó la moda, y en el caso de variables numércias se utilizó la mediana en caso de presencia de outliers. 

Al final, se hace una comprobación de que no quedaron valores faltantes, por lo que se imputaron todos los mismos. 

```{r, warning=FALSE, message=FALSE}
#Para variables numericas
moras <- moras %>%
  mutate(
    EDAD = ifelse(
      is.na(EDAD),
      median(EDAD, na.rm = TRUE),
      EDAD
    ),
    SALARIO = ifelse(
      is.na(SALARIO),
      median(SALARIO, na.rm = TRUE),
      SALARIO
    )
  )

#Para variables categóricas

moda.tipo <- mfv(moras$TIPO_ASEGURAMIENTO)

moras <- moras %>%
  mutate(
    TIPO_ASEGURAMIENTO = ifelse(
      is.na(TIPO_ASEGURAMIENTO),
      moda.tipo,
      TIPO_ASEGURAMIENTO
    )
  )

#Comprobación de que no quedan NA's
porc.na.moras <- moras %>% 
  select(-Z.Score.Salario, -Z.Score.Edad, -Atípico.salario, -Atípico.edad) %>% 
  summarise(across(everything(), ~ mean(is.na(.))*100))

porc.na.moras

```

## 6. Gráficos de cantidad de individuos por categoría

**Primer gráfico**. Cantidad de individuos por sexo

```{r, warning=FALSE, message=FALSE}
library(ggplot2)

#Individuos por sexo
moras %>% 
  ggplot(aes(x = SEXO)) +
  geom_bar(fill = "#FADADD") +
  labs(title = "Cantidad de individuos por sexo", 
       x = "Sexo", 
       y = "Cantidad") +
    theme_minimal()
```

El conjunto de datos presenta una mayor participación masculina dentro de la población analizada. Se observa que el grupo de hombres supera ampliamente al de mujeres, con una diferencia cercana a las mil personas. Esto sugiere que, al menos dentro de este registro específico, la afiliación o presencia en el sistema evaluado es mayor entre hombres que entre mujeres. Este desequilibrio podría influir en otros indicadores, como la distribución del tipo de aseguramiento o la morosidad, por lo que conviene tenerlo presente en el análisis posterior.

**Segundo gráfico**. Cantidad de individuos por tipo de aseguramiento
```{r, warning=FALSE, message=FALSE}
#Individuos por tipo de aseguramiento. Para mayor legibilidad, se invirtiron los ejes de manera que se observen bien los nombres del tipo de aseguramiento

moras %>% 
  ggplot(aes(x = TIPO_ASEGURAMIENTO)) +
  geom_bar(fill = "#FF9AA2") +
  coord_flip() +
  labs(title = "Cantidad por tipo de aseguramiento",
       x = "Tipo de aseguramiento",
       y = "Cantidad") +
  theme_minimal()
```

El tipo de aseguramiento dominante es el de asalariado, muy por encima del resto de categorías. Le siguen en menor medida “asegurado voluntario” y “trabajador independiente”. Las demás categorías representan proporciones muy pequeñas del total. Esta concentración en la categoría de asalariados indica que el comportamiento global del conjunto de datos estará fuertemente determinado por este grupo, especialmente en variables relacionadas con estabilidad laboral, ingresos y morosidad. También sugiere que los demás tipos de aseguramiento tienen un peso marginal en el análisis comparativo.

**Tercer gráfico**. Cantidad de individuos por sector

```{r, warning=FALSE, message=FALSE}
#Individuos por sector
moras %>% 
  ggplot(aes(x = SECTOR)) +
  geom_bar(fill = "#C2185B") +
  labs(title = "Cantidad de individuos por sector",
       x = "Sector",
       y = "Cantidad") +
  theme_minimal()
```

El sector privado concentra la mayor parte de los individuos, superando ampliamente al sector público. Esto refleja que la base de datos está compuesta en su mayoría por personas vinculadas a empleos privados, lo cual puede estar asociado a variaciones en nivel salarial, formalización laboral o probabilidad de morosidad. El sector público, aunque presente, tiene un peso bastante menor en el total.

**Cuarto gráfico**. Cantidad de individuos por indicador moroso
```{r, warning=FALSE, message=FALSE}
#Individuos por indicador moroso

moras %>% 
  count(INDICADOR_MOROSO) %>% 
  mutate(label = n) %>%
  ggplot(aes(x = "", y = n, fill = as.factor(INDICADOR_MOROSO))) +
  geom_col(color = "white") +
  geom_text(aes(label = label),
            position = position_stack(vjust = 0.5),
            color = "white", size = 5) +
  coord_polar(theta = "y") +
  scale_fill_manual(
    values = c("#FADADD", "#C2185B"),
    name   = "Moroso",
    labels = c("No moroso", "Moroso")
  ) +
  labs(
    title = "Cantidad de individuos morosos vs no morosos"
  ) +
  theme_void()
```

La gran mayoría de los individuos no presenta morosidad. El número de personas morosas es considerablemente menor, representando solo una fracción del total. Esta distribución implica que la morosidad es un fenómeno minoritario dentro del conjunto analizado. Sin embargo, su presencia sigue siendo relevante: alrededor de 800–900 casos representan un volumen suficiente para estudiar patrones y posibles factores asociados.

**Quinto gráfico**. Cantidad de individuos por indicador activo

```{r, warning=FALSE, message=FALSE}
#Individuos por indicador activo

moras %>% 
  count(INDICADOR_ACTIVO) %>% 
  mutate(label = n) %>%
  ggplot(aes(x = "", y = n, fill = as.factor(INDICADOR_ACTIVO))) +
  geom_col(color = "white") +
  geom_text(aes(label = label),
            position = position_stack(vjust = 0.5),
            color = "white", size = 5) +
  coord_polar(theta = "y") +
  scale_fill_manual(
    values = c("#FFB3C6", "#9B59B6"),
    name   = "Activo",
    labels = c("Inactivo", "Activo")
  ) +
  labs(
    title = "Proporción de asegurados activos vs inactivos"
  ) +
  theme_void()
```

El porcentaje de asegurados activos es prácticamente la totalidad del conjunto de datos. La cantidad de personas inactivas es mínima en comparación. Esto indica que la base está compuesta mayoritariamente por personas con vínculos vigentes o activos dentro del sistema de aseguramiento. Dado que la condición de actividad suele relacionarse con estabilidad laboral o ingreso regular, esta distribución puede influir en las tasas de morosidad observadas.

**Sexto gráfico**. Cantidad de individuos por indicador extranjero.
```{r, warning=FALSE, message=FALSE}

#Individuos por indicador extrajero

moras %>% 
  count(INDICADOR.EXTRANJERO) %>% 
  mutate(label = n)%>%
  ggplot(aes(x = "", y = n, fill = as.factor(INDICADOR.EXTRANJERO))) +
  geom_col(color = "white") +
  geom_text(aes(label = label),
            position = position_stack(vjust = 0.5),
            color = "white", size = 5) +
  coord_polar(theta = "y") +
  scale_fill_manual(
    values = c("#F7C6D0", "#E91E63"),
    name   = "Extranjero",
    labels = c("Nacional", "Extranjero")
  ) +
  labs(
    title = "Cantidad de individuos nacionales vs extranjeros"
  ) +
  theme_void()
```

La mayoría de los individuos son nacionales, mientras que el grupo de extranjeros representa una proporción mucho menor. Aunque los extranjeros constituyen una minoría, su presencia sigue siendo significativa y puede permitir comparaciones sobre diferencias en morosidad, tipo de aseguramiento o condiciones laborales. Esta composición también refleja la distribución esperada en una población general, donde los nacionales predominan ampliamente.

## 7. Gráficos de variables categóricas usando porcentajes

**Primer gráfico**. Porcentaje de morosidad por sexo
```{r, warning=FALSE, message=FALSE}
#Porcentaje de morosidad por sexo
moras %>%
  group_by(SEXO) %>%
  summarise(
    porcentaje.moroso = mean(INDICADOR_MOROSO == "SI", na.rm = TRUE) * 100
  ) %>%
  ggplot(aes(x = SEXO, y = porcentaje.moroso)) +
  geom_col(fill = "#FADADD") +
  labs(
    title = "Porcentaje de morosidad por sexo",
    x = "Sexo",
    y = "% de personas en estado de morosidad"
  ) +
  theme_minimal()
```

El porcentaje de morosidad entre hombres y mujeres es muy similar. Aunque los hombres presentan una proporción ligeramente mayor, la diferencia no parece ser sustancial. Esto sugiere que el sexo no es una variable particularmente determinante en la probabilidad de que una persona incurra en morosidad dentro de este conjunto de datos. En términos generales, tanto hombres como mujeres muestran niveles de morosidad comparables.

**Segundo gráfico**. Porcentaje de morosidad por tipo de aseguramiento
```{r, warning=FALSE, message=FALSE}
#Porcentaje de morosidad por tipo de aseguramiento
moras %>%
  group_by(TIPO_ASEGURAMIENTO) %>%
  summarise(
    porcentaje.moroso = mean(INDICADOR_MOROSO == "SI", na.rm = TRUE) * 100
  ) %>%
  ggplot(aes(x = porcentaje.moroso, y = TIPO_ASEGURAMIENTO)) +
  geom_col(fill = "#FF9AA2") +
  labs(
    title = "Porcentaje de morosidad por tipo de aseguramiento",
    x = "% de personas en estado de morosidad",
    y = "Tipo de aseguramiento"
  ) +
  theme_minimal()
```

Aquí sí se observan diferencias claras. Los trabajadores independientes concentran el porcentaje más alto de morosidad, superando el 40 %. Este resultado es consistente con la inestabilidad o irregularidad que puede caracterizar los ingresos en ese grupo.
Los asegurados voluntarios también presentan una morosidad relevante, aunque en menor medida.
En contraste, los asalariados –el grupo más numeroso– muestran un porcentaje de morosidad bajo, posiblemente asociado a la deducción automática de cuotas por planilla. Los pensionados y los asegurados bajo convenios especiales presentan los porcentajes más bajos, lo que indica una mayor estabilidad de pago dentro de esos sectores.
En conjunto, el tipo de aseguramiento sí aparece como un factor asociado a la morosidad.

**Tercer gráfico**. Porcentaje de morosidad por sector
```{r, warning=FALSE, message=FALSE}
#Porcentaje de morosidad por sector
moras %>%
  mutate(
    INDICADOR_MOROSO = factor(INDICADOR_MOROSO, levels = c("NO", "SI"))
  ) %>%
  group_by(SECTOR, INDICADOR_MOROSO) %>%
  summarise(
    n = n(),
    .groups = "drop"
  ) %>%
  group_by(SECTOR) %>%
  mutate(
    pct = n / sum(n) * 100
  ) %>%
  ggplot(aes(x = SECTOR, y = pct, fill = INDICADOR_MOROSO)) +
  geom_col() +
  scale_fill_manual(
    values = c("NO" = "#FADADD", "SI" = "#C2185B"),
    name = "Moroso",
    labels = c("NO" = "No moroso", "SI" = "Moroso")
  ) +
  labs(
    title = "Porcentaje de morosidad por sector",
    x = "Sector",
    y = "% de personas en estado de morosidad"
  ) +
  theme_minimal()
```

Los porcentajes de morosidad entre el sector público y privado son relativamente parecidos. El sector privado presenta un porcentaje apenas superior, pero la diferencia es pequeña. Esto indica que, pese a las diferencias en tamaño entre ambos grupos, el nivel de morosidad asociado al tipo de sector no muestra una variación marcada. En términos prácticos, pertenecer al sector público o privado no parece alterar de forma significativa la probabilidad de incurrir en morosidad.

**Cuarto gráfico**. Porcentaje de morosidad por indicador moroso
```{r, warning=FALSE, message=FALSE}
#Porcentaje de morosidad por indicador moroso
moras %>% 
  count(INDICADOR_MOROSO) %>% 
  mutate(
    prop  = n / sum(n),
    label = paste0(round(prop * 100, 1), "%")
  ) %>%
  ggplot(aes(x = "", y = prop, fill = INDICADOR_MOROSO)) +
  geom_col(color = "white") +
  geom_text(aes(label = label),
            position = position_stack(vjust = 0.5),
            color = "white", size = 5) +
  coord_polar(theta = "y") +
  scale_fill_manual(
    values = c("NO" = "#FADADD", "SI" = "#C2185B"),
    name   = "Moroso"
  ) +
  labs(title = "Porcentaje de morosos vs no morosos") +
  theme_void() 
```

La gran mayoría de los individuos se encuentra al día, mientras que cerca del 17 % presenta morosidad. Aunque este porcentaje no es dominante, sí representa una fracción importante de la población, lo cual justifica analizar los factores asociados. En general, el comportamiento observado coincide con patrones típicos de bases de aseguramiento, donde la mayoría mantiene sus obligaciones al día, pero existe un grupo no despreciable con dificultades de pago.

**Quinto gráfico**. Porcentaje de morosidad por indicador activo

```{r, warning=FALSE, message=FALSE}
#Porcentaje de morosidad por indicador activo
moras %>% 
  count(INDICADOR_ACTIVO) %>% 
  mutate(
    prop  = n / sum(n),
    label = paste0(round(prop * 100, 1), "%")
  ) %>%
  ggplot(aes(x = "", y = prop, fill = INDICADOR_ACTIVO)) +
  geom_col(color = "white") +
  geom_text(aes(label = label),
            position = position_stack(vjust = 0.5),
            color = "white", size = 5) +
  coord_polar(theta = "y") +
  scale_fill_manual(
    values = c("NO" = "#FFB3C6", "SI" = "#9B59B6"),
    name   = "Activo"
  ) +
  labs(title = "Porcentaje de individuos activos vs inactivos") +
  theme_void()
```

Prácticamente todas las personas registradas están activas; solo un porcentaje muy pequeño aparece como inactivo. Esto indica que la base está compuesta casi en su totalidad por asegurados con condición vigente. La marcada desproporción sugiere que el estado de actividad no es una variable útil para explicar la morosidad, simplemente porque la cantidad de inactivos es mínima.

**Sexto gráfico**. Porcentaje de morosidad por indicador extranjero
```{r, warning=FALSE, message=FALSE}
#Porcentaje de morosidad por indicador extranjero
moras %>% 
  count(INDICADOR.EXTRANJERO) %>% 
  mutate(
    prop  = n / sum(n),
    label = paste0(round(prop * 100, 1), "%")
  ) %>%
  ggplot(aes(x = "", y = prop, fill = INDICADOR.EXTRANJERO)) +
  geom_col(color = "white") +
  geom_text(aes(label = label),
            position = position_stack(vjust = 0.5),
            color = "white", size = 5) +
  coord_polar(theta = "y") +
  scale_fill_manual(
    values = c("NO" = "#F7C6D0", "SI" = "#E91E63"),
    name   = "Extranjero"
  ) +
  labs(title = "Porcentaje de nacionales vs extranjeros") +
  theme_void() 
```

La morosidad se presenta tanto en nacionales como en extranjeros, pero la proporción es mayor entre los extranjeros. Aunque representan un grupo mucho más pequeño dentro del total, su porcentaje de morosidad supera el 12 %, lo cual es ligeramente más alto que lo observado en nacionales. Esto podría relacionarse con condiciones de empleo, estabilidad migratoria o tipo de aseguramiento, por lo que conviene interpretarlo junto con los otros factores.

## 8. Gráficos para variables numéricas

En este caso, dado que hay muchos valores distintos tanto para la edad como para los salarios, se optó por una alternativa en donde se categorizan las edades y salarios. En el caso se las edades, se tomaron 5 grupos, y en el caso de los salarios se tomaron 4 grupos correspondientes a los cuartiles de la columna de salarios. 

**Primer gráfico**. Porcentaje de morosidad por rangos de salario.
```{r, warning=FALSE, message=FALSE}
cuartiles_salario <- quantile(moras$SALARIO,
                              probs = seq(0, 1, 0.25),
                              na.rm = TRUE)

moras.cat <- moras %>%
  mutate(
    rango.edad = cut(
      EDAD,
      breaks = c(0, 25, 35, 45, 55, Inf),
      right  = FALSE,
      labels = c("0–24", "25–34", "35–44", "45–54", "55+")
    ),
    rango.salario = cut(
      SALARIO,
      breaks = cuartiles_salario,
      include.lowest = TRUE,
      labels = c("Q1", "Q2", "Q3", "Q4")
    )
  )

#Porcentaje de morosidad por rangos de salario
moras.cat %>%
  group_by(rango.edad, INDICADOR_MOROSO) %>%
  summarise(
    n = n(),
    .groups = "drop"
  ) %>%
  group_by(rango.edad) %>%
  mutate(
    porc = n / sum(n) * 100
  ) %>%
  ggplot(aes(x = rango.edad, y = porc, fill = INDICADOR_MOROSO)) +
  geom_col() +
  scale_fill_manual(
    values = c("NO" = "#FADADD", "SI" = "#C2185B"),
    name   = "Moroso"
  ) +
  labs(
    title = "Porcentaje de morosidad por rango de edad",
    x = "Rango de edad",
    y = "% de personas en estado de morosidad / no morosidad"
  ) +
  theme_minimal()
```

El nivel de morosidad muestra variaciones según la edad, aunque las diferencias no son extremadamente marcadas.
Los grupos más jóvenes (0–24 y 25–34) presentan los porcentajes más bajos de morosidad, lo que podría relacionarse con el hecho de que muchos apenas ingresan al mercado laboral o aún dependen de otra figura asegurada.

A partir de los 35 años, la morosidad aumenta y alcanza su punto más alto en el grupo de 45–54 años. Este comportamiento coincide con etapas donde las responsabilidades económicas suelen ser mayores, como créditos, vivienda o dependientes económicos, lo que podría traducirse en mayor presión financiera.

En el rango de 55 años o más, la morosidad disminuye nuevamente, posiblemente porque muchas personas ya están en etapas de mayor estabilidad laboral o en transición hacia la pensión.
En resumen, la morosidad parece crecer con la edad hasta un punto medio y luego reducirse ligeramente en los grupos de mayor edad.

**Segundo gráfico**. Porcentaje de morosidad por cuartil de salarios
```{r, warning=FALSE, message=FALSE}

#Porcentaje de morosidad por cuartitl de salario
moras.cat %>%
  group_by(rango.salario, INDICADOR_MOROSO) %>%
  summarise(
    n = n(),
    .groups = "drop"
  ) %>%
  group_by(rango.salario) %>%
  mutate(
    porc = n / sum(n) * 100
  ) %>%
  ggplot(aes(x = rango.salario, y = porc, fill = INDICADOR_MOROSO)) +
  geom_col() +
  scale_fill_manual(
    values = c("NO" = "#FADADD", "SI" = "#C2185B"),
    name   = "Moroso"
  ) +
  labs(
    title = "Porcentaje de morosidad por cuartil de salario",
    x = "Cuartil de salario",
    y = "% de personas en estado de morosidad / no morosidad"
  ) +
  theme_minimal()
```
La morosidad varía entre los cuartiles de ingreso, aunque las diferencias son relativamente moderadas.
El cuartil más bajo (Q1) presenta niveles altos de morosidad, lo cual es consistente con menores ingresos disponibles y mayor vulnerabilidad financiera. El cuartil Q2 también muestra una morosidad elevada, incluso ligeramente superior a Q1, lo que sugiere que los ingresos bajos y medios-bajos pueden enfrentar dificultades parecidas para mantenerse al día.

A medida que los ingresos aumentan (Q3 y especialmente Q4), el porcentaje de morosidad disminuye. El cuartil más alto es el que registra la menor proporción de personas morosas, lo cual concuerda con una mayor estabilidad económica y capacidad de pago.

En conjunto, este patrón refleja una relación razonable entre nivel salarial y morosidad: los grupos con mayores ingresos tienden a presentar mejores condiciones para cumplir sus obligaciones de aseguramiento, mientras que los niveles más bajos concentran las dificultades.

## 10. Árbol de decisión

Primero, transformamos las variables numéricas en categorías, para después generar el árbol de decisión. Además, se tomaron abreviaturas del tipo de aseguramiento para mejor legibilidad. 

```{r, warning=FALSE, message=FALSE}

library(forcats)
library(rpart)
library(rpart.plot)

moras.arbol <- moras %>%
  mutate(
    rango.edad = cut(
      EDAD,
      breaks = c(0, 25, 35, 45, 55, Inf),
      right  = FALSE,
      labels = c("0–24", "25–34", "35–44", "45–54", "55+")
    ),
    rango.salario = cut(
      SALARIO,
      breaks = cuartiles_salario,
      include.lowest = TRUE,
      labels = c("Q1", "Q2", "Q3", "Q4")
    ),
    TIPO_ASEGURAMIENTO = fct_recode(
      TIPO_ASEGURAMIENTO,
      "AS." = "ASALARIADO",
      "VOL." = "ASEGURADO VOLUNTARIO",
      "CONV.VOL." = "CONVENIOS ESPECIALES DE ASEGURADOS VOLUNTARIOS",
      "CONV.INDEP." = "CONVENIOS ESPECIALES DE TRABAJADORES INDEPENDENTES",
      "PEN." = "PENSIONADOS EN SU PROPIO SISTEMA",
      "TRAB.INDEP." = "TRABAJADOR INDEPENDIENTE"
    ),
    INDICADOR_MOROSO = factor(INDICADOR_MOROSO,
                              levels = c("NO", "SI"))
  ) %>%
  select(
    INDICADOR_MOROSO,
    SEXO,
    TIPO_ASEGURAMIENTO,
    SECTOR,
    INDICADOR_ACTIVO,
    INDICADOR.EXTRANJERO,
    rango.edad,
    rango.salario
  )

tree <- rpart(INDICADOR_MOROSO ~ ., data = moras.arbol)
rpart.plot(tree)

```
El árbol de decisión permite identificar cuáles características de las personas están más relacionadas con la morosidad. Al analizar el modelo, lo primero que se observa es que el factor que más influye en que una persona sea morosa o no es el tipo de aseguramiento. Desde el inicio, el árbol divide la población en distintos grupos según esta variable, porque algunos tipos de aseguramiento concentran un nivel de morosidad bastante mayor que otros. En ciertos esquemas, la mayoría de las personas se mantiene al día, mientras que en otros la morosidad es considerablemente más frecuente. Esto convierte al tipo de aseguramiento en el criterio principal para distinguir entre clientes de bajo y alto riesgo.

Una vez separados esos grupos, el árbol muestra que el segundo elemento relevante es si la persona es extranjera o no. Entre los tipos de aseguramiento que ya presentaban mayores niveles de morosidad, los extranjeros suelen concentrar un riesgo todavía mayor. Esto indica que la nacionalidad agrega un nivel adicional de vulnerabilidad dentro de los grupos que ya eran más propensos al atraso.

Después de esto, el modelo introduce el rango salarial como otro factor capaz de diferenciar niveles de riesgo. No todos los niveles de ingreso se comportan igual: en algunos cuartiles la morosidad es más habitual, mientras que en otros tiende a disminuir. Esto sugiere que, además del tipo de aseguramiento y de la nacionalidad, la capacidad económica también ayuda a explicar por qué algunas personas se atrasan más que otras.

Finalmente, en un grupo más pequeño y específico, el árbol incluye el sexo como una variable que ajusta ligeramente la probabilidad de morosidad, aunque su efecto es mucho más débil que el de las variables anteriores. Esto significa que, aunque el sexo puede marcar cierta diferencia en casos muy puntuales, no es un factor central para entender el riesgo de atraso.

En conjunto, el árbol revela que la morosidad no se distribuye de manera uniforme en la población, sino que está fuertemente asociada primero al tipo de aseguramiento, luego a la nacionalidad y después al nivel salarial. 